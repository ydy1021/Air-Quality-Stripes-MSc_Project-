{"ast":null,"code":"var _jsxFileName = \"E:\\\\Master2\\\\FYP\\\\Global\\\\Global\\\\dashboard_ComparisionVersion\\\\src\\\\Map.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport * as topojson from 'topojson-client';\nimport PM25DataLoader from './PM25DataLoader';\nimport PM25Canvas from './PM25Canvas';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WORLD_GEOJSON_URL = 'world-110m.geojson';\nconst CITIES_JSON = 'cities_with_coords.json';\n\n// PM2.5色阶区间和颜色，与MultiTrendCharts.js保持一致\nconst bounds = [0, 5, 10, 15, 20, 30, 40, 50, 60, 70, 80, 90, 99999];\nconst c_list = ['rgb(164,255,255)',\n// 0 - 5\n'rgb(176,218,233)',\n// 5 - 10\n'rgb(176,206,237)',\n// 10 - 15\n'rgb(249,224,71)',\n// 15 - 20\n'rgb(242,200,75)',\n// 20 - 30\n'rgb(241,166,63)',\n// 30 - 40\n'rgb(233,135,37)',\n// 40 - 50\n'rgb(175,69,83)',\n// 50 - 60\n'rgb(134,59,71)',\n// 60 - 70\n'rgb(103,58,61)',\n// 70 - 80\n'rgb(70,47,48)',\n// 80 - 90\n'rgb(37,36,36)' // 90+\n];\nfunction getColor(val) {\n  if (val === null || val === undefined || isNaN(val)) return '#e0e0e0';\n  for (let i = 0; i < bounds.length - 1; ++i) {\n    if (val >= bounds[i] && val < bounds[i + 1]) return c_list[i];\n  }\n  return c_list[c_list.length - 1];\n}\nfunction Map({\n  onCitySelect,\n  selectedCities,\n  maxCities = 2\n}) {\n  _s();\n  const svgRef = useRef();\n  const containerRef = useRef();\n  const [cities, setCities] = useState([]);\n  const [world, setWorld] = useState(null);\n  const [pm25Loader, setPm25Loader] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [projection, setProjection] = useState(null);\n  const [transform, setTransform] = useState({\n    k: 1,\n    x: 0,\n    y: 0\n  });\n  const [zoom, setZoom] = useState(null);\n\n  // 加载数据\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        setIsLoading(true);\n\n        // 并行加载地图和城市数据\n        const [worldData, citiesData] = await Promise.all([d3.json(WORLD_GEOJSON_URL), d3.json(CITIES_JSON)]);\n        setWorld(worldData);\n        setCities(citiesData);\n\n        // 加载PM2.5数据\n        const loader = new PM25DataLoader();\n        const success = await loader.loadData();\n        if (success) {\n          setPm25Loader(loader);\n          console.log('PM2.5 data stats:', loader.getDataStats());\n        } else {\n          console.warn('PM2.5 data loading failed, using default colors');\n        }\n      } catch (error) {\n        console.error('Error loading data:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n  }, []);\n\n  // 获取地理位置的PM2.5值\n  const getPM25ForLocation = (lat, lon) => {\n    if (!pm25Loader) return null;\n    return pm25Loader.getPM25Value(lat, lon);\n  };\n\n  // 缩放控制函数\n  const handleZoomIn = () => {\n    if (zoom) {\n      d3.select(svgRef.current).transition().duration(300).call(zoom.scaleBy, 1.5);\n    }\n  };\n  const handleZoomOut = () => {\n    if (zoom) {\n      d3.select(svgRef.current).transition().duration(300).call(zoom.scaleBy, 1 / 1.5);\n    }\n  };\n  const handleReset = () => {\n    if (zoom) {\n      const identity = d3.zoomIdentity;\n      d3.select(svgRef.current).transition().duration(500).call(zoom.transform, identity);\n    }\n  };\n\n  // 绘制地图\n  useEffect(() => {\n    if (!world || !world.features || !cities.length || isLoading) return;\n    const width = 1000,\n      height = 500;\n    const svg = d3.select(svgRef.current).attr('width', width).attr('height', height);\n    svg.selectAll('*').remove();\n\n    // 投影\n    const mapProjection = d3.geoNaturalEarth1().fitSize([width, height], world);\n    const path = d3.geoPath().projection(mapProjection);\n    setProjection(() => mapProjection); // 保存投影供Canvas使用\n\n    // 创建主要的g元素用于缩放变换\n    const g = svg.append('g').attr('class', 'map-group');\n\n    // 首先绘制基础地图（作为背景）\n    g.append('g').attr('class', 'countries-background').selectAll('path').data(world.features).enter().append('path').attr('d', path).attr('fill', '#f0f0f0').attr('stroke', '#ccc').attr('stroke-width', 0.5);\n\n    // 重新绘制国家边界（在网格之上）\n    g.append('g').attr('class', 'countries-borders').selectAll('path').data(world.features).enter().append('path').attr('d', path).attr('fill', 'none').attr('stroke', '#666').attr('stroke-width', 0.8).style('pointer-events', 'all').append('title').text(d => {\n      if (!d || !d.properties) return 'Unknown';\n      const countryName = d.properties.NAME || d.properties.name || 'Unknown';\n      try {\n        const centroid = d3.geoCentroid(d);\n        if (centroid && centroid.length >= 2) {\n          const [lon, lat] = centroid;\n          const pm25Value = getPM25ForLocation(lat, lon);\n          return pm25Value !== null ? `${countryName}\\nCenter PM2.5 (2022): ${pm25Value.toFixed(1)} µg/m³` : `${countryName}`;\n        }\n      } catch (error) {\n        console.warn('Error calculating centroid for country:', countryName, error);\n      }\n      return countryName;\n    });\n\n    // 绘制城市点\n    const citiesGroup = g.append('g').attr('class', 'cities');\n    citiesGroup.selectAll('circle').data(cities).enter().append('circle').attr('cx', d => mapProjection([d.lng, d.lat])[0]).attr('cy', d => mapProjection([d.lng, d.lat])[1]).attr('r', 5) // 基础半径\n    .attr('fill', d => selectedCities.find(c => c.city === d.city && c.country === d.country) ? '#d32f2f' : '#1976d2').attr('stroke', '#fff').attr('stroke-width', 3).style('cursor', 'pointer').style('filter', 'drop-shadow(0px 2px 4px rgba(0,0,0,0.3))').on('click', (event, d) => {\n      onCitySelect(d);\n    }).append('title').text(d => {\n      const pm25Value = getPM25ForLocation(d.lat, d.lng);\n      return pm25Value !== null ? `${d.city}, ${d.country}\\nPM2.5 (2022): ${pm25Value.toFixed(1)} µg/m³` : `${d.city}, ${d.country}\\nPM2.5: No data`;\n    });\n\n    // 设置缩放行为\n    const zoomBehavior = d3.zoom().scaleExtent([0.5, 8]) // 缩放范围：0.5倍到8倍\n    .on('zoom', event => {\n      if (!event || !event.transform) return;\n      const {\n        transform\n      } = event;\n      setTransform(transform);\n\n      // 应用变换到主要的g元素\n      if (g) {\n        g.attr('transform', transform);\n      }\n\n      // 调整城市点大小，保持视觉大小不变\n      if (citiesGroup && transform.k > 0) {\n        citiesGroup.selectAll('circle').attr('r', 5 / transform.k) // 反比例缩放半径\n        .attr('stroke-width', 3 / transform.k); // 反比例缩放边框宽度\n      }\n\n      // 调整国家边界线宽度\n      if (transform.k > 0) {\n        g.selectAll('.countries-borders path').attr('stroke-width', 0.8 / transform.k);\n        g.selectAll('.countries-background path').attr('stroke-width', 0.5 / transform.k);\n      }\n    });\n    svg.call(zoomBehavior);\n    setZoom(zoomBehavior);\n\n    // 添加色阶图例（固定位置，不受缩放影响）\n    if (pm25Loader) {\n      const legendWidth = 300;\n      const legendHeight = 20;\n      const legendX = width - legendWidth - 20;\n      const legendY = height - 60;\n      const legendGroup = svg.append('g').attr('class', 'legend');\n\n      // 图例背景\n      legendGroup.append('rect').attr('x', legendX - 10).attr('y', legendY - 25).attr('width', legendWidth + 20).attr('height', 50).attr('fill', 'white').attr('stroke', '#ccc').attr('rx', 5);\n\n      // 色阶条\n      const legendScale = d3.scaleLinear().domain([0, bounds.length - 2]).range([0, legendWidth]);\n      legendGroup.append('g').selectAll('rect').data(c_list.slice(0, -1)).enter().append('rect').attr('x', (d, i) => legendX + legendScale(i)).attr('y', legendY).attr('width', legendWidth / (c_list.length - 1)).attr('height', legendHeight).attr('fill', d => d);\n\n      // 图例标题\n      legendGroup.append('text').attr('x', legendX).attr('y', legendY - 5).attr('font-size', 12).attr('font-weight', 'bold').text('PM2.5 Concentration (µg/m³) - 2022');\n\n      // 数值标签\n      const labelValues = [0, 10, 20, 30, 50, 70, 90];\n      legendGroup.append('g').selectAll('text').data(labelValues).enter().append('text').attr('x', d => {\n        const index = bounds.findIndex(b => b >= d);\n        return legendX + legendScale(Math.max(0, index));\n      }).attr('y', legendY + legendHeight + 15).attr('text-anchor', 'middle').attr('font-size', 10).text(d => d);\n    }\n  }, [world, cities, selectedCities, onCitySelect, maxCities, pm25Loader, isLoading]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      textAlign: 'center'\n    },\n    children: [isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        margin: 20,\n        color: '#666'\n      },\n      children: \"Loading PM2.5 data and map...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'relative',\n        display: 'inline-block'\n      },\n      ref: containerRef,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          top: 10,\n          left: 10,\n          zIndex: 10,\n          display: 'flex',\n          flexDirection: 'column',\n          gap: '5px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleZoomIn,\n          style: {\n            width: 30,\n            height: 30,\n            border: '1px solid #ccc',\n            backgroundColor: 'white',\n            borderRadius: '3px',\n            cursor: 'pointer',\n            fontSize: '16px',\n            fontWeight: 'bold',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\n          },\n          title: \"\\u653E\\u5927\",\n          children: \"+\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleZoomOut,\n          style: {\n            width: 30,\n            height: 30,\n            border: '1px solid #ccc',\n            backgroundColor: 'white',\n            borderRadius: '3px',\n            cursor: 'pointer',\n            fontSize: '16px',\n            fontWeight: 'bold',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\n          },\n          title: \"\\u7F29\\u5C0F\",\n          children: \"\\u2212\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleReset,\n          style: {\n            width: 30,\n            height: 30,\n            border: '1px solid #ccc',\n            backgroundColor: 'white',\n            borderRadius: '3px',\n            cursor: 'pointer',\n            fontSize: '10px',\n            fontWeight: 'bold',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\n          },\n          title: \"\\u91CD\\u7F6E\\u89C6\\u56FE\",\n          children: \"\\u2302\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n        ref: svgRef,\n        style: {\n          cursor: 'grab'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 9\n      }, this), projection && pm25Loader && /*#__PURE__*/_jsxDEV(PM25Canvas, {\n        pm25Loader: pm25Loader,\n        projection: projection,\n        width: 1000,\n        height: 500,\n        cities: cities,\n        transform: transform\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 8,\n        color: '#888'\n      },\n      children: pm25Loader ? '拖拽平移地图，使用鼠标滚轮或左上角按钮缩放' : '* Loading PM2.5 data for map coloring...'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 288,\n    columnNumber: 5\n  }, this);\n}\n_s(Map, \"vbPTHkfE2N4tYP9xENcaVB8z7gQ=\");\n_c = Map;\nexport default Map;\nvar _c;\n$RefreshReg$(_c, \"Map\");","map":{"version":3,"names":["React","useEffect","useRef","useState","d3","topojson","PM25DataLoader","PM25Canvas","jsxDEV","_jsxDEV","WORLD_GEOJSON_URL","CITIES_JSON","bounds","c_list","getColor","val","undefined","isNaN","i","length","Map","onCitySelect","selectedCities","maxCities","_s","svgRef","containerRef","cities","setCities","world","setWorld","pm25Loader","setPm25Loader","isLoading","setIsLoading","projection","setProjection","transform","setTransform","k","x","y","zoom","setZoom","loadData","worldData","citiesData","Promise","all","json","loader","success","console","log","getDataStats","warn","error","getPM25ForLocation","lat","lon","getPM25Value","handleZoomIn","select","current","transition","duration","call","scaleBy","handleZoomOut","handleReset","identity","zoomIdentity","features","width","height","svg","attr","selectAll","remove","mapProjection","geoNaturalEarth1","fitSize","path","geoPath","g","append","data","enter","style","text","d","properties","countryName","NAME","name","centroid","geoCentroid","pm25Value","toFixed","citiesGroup","lng","find","c","city","country","on","event","zoomBehavior","scaleExtent","legendWidth","legendHeight","legendX","legendY","legendGroup","legendScale","scaleLinear","domain","range","slice","labelValues","index","findIndex","b","Math","max","textAlign","children","margin","color","fileName","_jsxFileName","lineNumber","columnNumber","position","display","ref","top","left","zIndex","flexDirection","gap","onClick","border","backgroundColor","borderRadius","cursor","fontSize","fontWeight","alignItems","justifyContent","boxShadow","title","marginTop","_c","$RefreshReg$"],"sources":["E:/Master2/FYP/Global/Global/dashboard_ComparisionVersion/src/Map.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport * as d3 from 'd3';\r\nimport * as topojson from 'topojson-client';\r\nimport PM25DataLoader from './PM25DataLoader';\r\nimport PM25Canvas from './PM25Canvas';\r\n\r\nconst WORLD_GEOJSON_URL = 'world-110m.geojson';\r\nconst CITIES_JSON = 'cities_with_coords.json';\r\n\r\n// PM2.5色阶区间和颜色，与MultiTrendCharts.js保持一致\r\nconst bounds = [0, 5, 10, 15, 20, 30, 40, 50, 60, 70, 80, 90, 99999];\r\nconst c_list = [\r\n  'rgb(164,255,255)',  // 0 - 5\r\n  'rgb(176,218,233)',  // 5 - 10\r\n  'rgb(176,206,237)',  // 10 - 15\r\n  'rgb(249,224,71)',   // 15 - 20\r\n  'rgb(242,200,75)',   // 20 - 30\r\n  'rgb(241,166,63)',   // 30 - 40\r\n  'rgb(233,135,37)',   // 40 - 50\r\n  'rgb(175,69,83)',    // 50 - 60\r\n  'rgb(134,59,71)',    // 60 - 70\r\n  'rgb(103,58,61)',    // 70 - 80\r\n  'rgb(70,47,48)',     // 80 - 90\r\n  'rgb(37,36,36)',     // 90+\r\n];\r\n\r\nfunction getColor(val) {\r\n  if (val === null || val === undefined || isNaN(val)) return '#e0e0e0';\r\n  for (let i = 0; i < bounds.length - 1; ++i) {\r\n    if (val >= bounds[i] && val < bounds[i + 1]) return c_list[i];\r\n  }\r\n  return c_list[c_list.length - 1];\r\n}\r\n\r\nfunction Map({ onCitySelect, selectedCities, maxCities = 2 }) {\r\n  const svgRef = useRef();\r\n  const containerRef = useRef();\r\n  const [cities, setCities] = useState([]);\r\n  const [world, setWorld] = useState(null);\r\n  const [pm25Loader, setPm25Loader] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [projection, setProjection] = useState(null);\r\n  const [transform, setTransform] = useState({ k: 1, x: 0, y: 0 });\r\n  const [zoom, setZoom] = useState(null);\r\n\r\n  // 加载数据\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        \r\n        // 并行加载地图和城市数据\r\n        const [worldData, citiesData] = await Promise.all([\r\n          d3.json(WORLD_GEOJSON_URL),\r\n          d3.json(CITIES_JSON)\r\n        ]);\r\n        \r\n        setWorld(worldData);\r\n        setCities(citiesData);\r\n        \r\n        // 加载PM2.5数据\r\n        const loader = new PM25DataLoader();\r\n        const success = await loader.loadData();\r\n        if (success) {\r\n          setPm25Loader(loader);\r\n          console.log('PM2.5 data stats:', loader.getDataStats());\r\n        } else {\r\n          console.warn('PM2.5 data loading failed, using default colors');\r\n        }\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading data:', error);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    \r\n    loadData();\r\n  }, []);\r\n\r\n  // 获取地理位置的PM2.5值\r\n  const getPM25ForLocation = (lat, lon) => {\r\n    if (!pm25Loader) return null;\r\n    return pm25Loader.getPM25Value(lat, lon);\r\n  };\r\n\r\n  // 缩放控制函数\r\n  const handleZoomIn = () => {\r\n    if (zoom) {\r\n      d3.select(svgRef.current).transition().duration(300).call(zoom.scaleBy, 1.5);\r\n    }\r\n  };\r\n\r\n  const handleZoomOut = () => {\r\n    if (zoom) {\r\n      d3.select(svgRef.current).transition().duration(300).call(zoom.scaleBy, 1 / 1.5);\r\n    }\r\n  };\r\n\r\n  const handleReset = () => {\r\n    if (zoom) {\r\n      const identity = d3.zoomIdentity;\r\n      d3.select(svgRef.current).transition().duration(500).call(zoom.transform, identity);\r\n    }\r\n  };\r\n\r\n  // 绘制地图\r\n  useEffect(() => {\r\n    if (!world || !world.features || !cities.length || isLoading) return;\r\n    \r\n    const width = 1000, height = 500;\r\n    const svg = d3.select(svgRef.current)\r\n      .attr('width', width)\r\n      .attr('height', height);\r\n    svg.selectAll('*').remove();\r\n\r\n    // 投影\r\n    const mapProjection = d3.geoNaturalEarth1().fitSize([width, height], world);\r\n    const path = d3.geoPath().projection(mapProjection);\r\n    setProjection(() => mapProjection); // 保存投影供Canvas使用\r\n\r\n    // 创建主要的g元素用于缩放变换\r\n    const g = svg.append('g').attr('class', 'map-group');\r\n\r\n    // 首先绘制基础地图（作为背景）\r\n    g.append('g')\r\n      .attr('class', 'countries-background')\r\n      .selectAll('path')\r\n      .data(world.features)\r\n      .enter()\r\n      .append('path')\r\n      .attr('d', path)\r\n      .attr('fill', '#f0f0f0')\r\n      .attr('stroke', '#ccc')\r\n      .attr('stroke-width', 0.5);\r\n\r\n    // 重新绘制国家边界（在网格之上）\r\n    g.append('g')\r\n      .attr('class', 'countries-borders')\r\n      .selectAll('path')\r\n      .data(world.features)\r\n      .enter()\r\n      .append('path')\r\n      .attr('d', path)\r\n      .attr('fill', 'none')\r\n      .attr('stroke', '#666')\r\n      .attr('stroke-width', 0.8)\r\n      .style('pointer-events', 'all')\r\n      .append('title')\r\n      .text(d => {\r\n        if (!d || !d.properties) return 'Unknown';\r\n        const countryName = d.properties.NAME || d.properties.name || 'Unknown';\r\n        try {\r\n          const centroid = d3.geoCentroid(d);\r\n          if (centroid && centroid.length >= 2) {\r\n            const [lon, lat] = centroid;\r\n            const pm25Value = getPM25ForLocation(lat, lon);\r\n            return pm25Value !== null \r\n              ? `${countryName}\\nCenter PM2.5 (2022): ${pm25Value.toFixed(1)} µg/m³`\r\n              : `${countryName}`;\r\n          }\r\n        } catch (error) {\r\n          console.warn('Error calculating centroid for country:', countryName, error);\r\n        }\r\n        return countryName;\r\n      });\r\n\r\n    // 绘制城市点\r\n    const citiesGroup = g.append('g').attr('class', 'cities');\r\n    citiesGroup.selectAll('circle')\r\n      .data(cities)\r\n      .enter()\r\n      .append('circle')\r\n      .attr('cx', d => mapProjection([d.lng, d.lat])[0])\r\n      .attr('cy', d => mapProjection([d.lng, d.lat])[1])\r\n      .attr('r', 5) // 基础半径\r\n      .attr('fill', d => selectedCities.find(c => c.city === d.city && c.country === d.country) ? '#d32f2f' : '#1976d2')\r\n      .attr('stroke', '#fff')\r\n      .attr('stroke-width', 3)\r\n      .style('cursor', 'pointer')\r\n      .style('filter', 'drop-shadow(0px 2px 4px rgba(0,0,0,0.3))')\r\n      .on('click', (event, d) => {\r\n        onCitySelect(d);\r\n      })\r\n      .append('title')\r\n      .text(d => {\r\n        const pm25Value = getPM25ForLocation(d.lat, d.lng);\r\n        return pm25Value !== null \r\n          ? `${d.city}, ${d.country}\\nPM2.5 (2022): ${pm25Value.toFixed(1)} µg/m³`\r\n          : `${d.city}, ${d.country}\\nPM2.5: No data`;\r\n      });\r\n\r\n    // 设置缩放行为\r\n    const zoomBehavior = d3.zoom()\r\n      .scaleExtent([0.5, 8]) // 缩放范围：0.5倍到8倍\r\n      .on('zoom', (event) => {\r\n        if (!event || !event.transform) return;\r\n        \r\n        const { transform } = event;\r\n        setTransform(transform);\r\n        \r\n        // 应用变换到主要的g元素\r\n        if (g) {\r\n          g.attr('transform', transform);\r\n        }\r\n        \r\n        // 调整城市点大小，保持视觉大小不变\r\n        if (citiesGroup && transform.k > 0) {\r\n          citiesGroup.selectAll('circle')\r\n            .attr('r', 5 / transform.k) // 反比例缩放半径\r\n            .attr('stroke-width', 3 / transform.k); // 反比例缩放边框宽度\r\n        }\r\n        \r\n        // 调整国家边界线宽度\r\n        if (transform.k > 0) {\r\n          g.selectAll('.countries-borders path')\r\n            .attr('stroke-width', 0.8 / transform.k);\r\n          g.selectAll('.countries-background path')\r\n            .attr('stroke-width', 0.5 / transform.k);\r\n        }\r\n      });\r\n\r\n    svg.call(zoomBehavior);\r\n    setZoom(zoomBehavior);\r\n\r\n    // 添加色阶图例（固定位置，不受缩放影响）\r\n    if (pm25Loader) {\r\n      const legendWidth = 300;\r\n      const legendHeight = 20;\r\n      const legendX = width - legendWidth - 20;\r\n      const legendY = height - 60;\r\n\r\n      const legendGroup = svg.append('g').attr('class', 'legend');\r\n\r\n      // 图例背景\r\n      legendGroup.append('rect')\r\n        .attr('x', legendX - 10)\r\n        .attr('y', legendY - 25)\r\n        .attr('width', legendWidth + 20)\r\n        .attr('height', 50)\r\n        .attr('fill', 'white')\r\n        .attr('stroke', '#ccc')\r\n        .attr('rx', 5);\r\n\r\n      // 色阶条\r\n      const legendScale = d3.scaleLinear()\r\n        .domain([0, bounds.length - 2])\r\n        .range([0, legendWidth]);\r\n\r\n      legendGroup.append('g')\r\n        .selectAll('rect')\r\n        .data(c_list.slice(0, -1))\r\n        .enter()\r\n        .append('rect')\r\n        .attr('x', (d, i) => legendX + legendScale(i))\r\n        .attr('y', legendY)\r\n        .attr('width', legendWidth / (c_list.length - 1))\r\n        .attr('height', legendHeight)\r\n        .attr('fill', d => d);\r\n\r\n      // 图例标题\r\n      legendGroup.append('text')\r\n        .attr('x', legendX)\r\n        .attr('y', legendY - 5)\r\n        .attr('font-size', 12)\r\n        .attr('font-weight', 'bold')\r\n        .text('PM2.5 Concentration (µg/m³) - 2022');\r\n\r\n      // 数值标签\r\n      const labelValues = [0, 10, 20, 30, 50, 70, 90];\r\n      legendGroup.append('g')\r\n        .selectAll('text')\r\n        .data(labelValues)\r\n        .enter()\r\n        .append('text')\r\n        .attr('x', d => {\r\n          const index = bounds.findIndex(b => b >= d);\r\n          return legendX + legendScale(Math.max(0, index));\r\n        })\r\n        .attr('y', legendY + legendHeight + 15)\r\n        .attr('text-anchor', 'middle')\r\n        .attr('font-size', 10)\r\n        .text(d => d);\r\n    }\r\n  }, [world, cities, selectedCities, onCitySelect, maxCities, pm25Loader, isLoading]);\r\n\r\n  return (\r\n    <div style={{ textAlign: 'center' }}>\r\n      {isLoading && (\r\n        <div style={{ margin: 20, color: '#666' }}>\r\n          Loading PM2.5 data and map...\r\n        </div>\r\n      )}\r\n      <div style={{ position: 'relative', display: 'inline-block' }} ref={containerRef}>\r\n        {/* 缩放控制按钮 */}\r\n        <div style={{\r\n          position: 'absolute',\r\n          top: 10,\r\n          left: 10,\r\n          zIndex: 10,\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          gap: '5px'\r\n        }}>\r\n          <button\r\n            onClick={handleZoomIn}\r\n            style={{\r\n              width: 30,\r\n              height: 30,\r\n              border: '1px solid #ccc',\r\n              backgroundColor: 'white',\r\n              borderRadius: '3px',\r\n              cursor: 'pointer',\r\n              fontSize: '16px',\r\n              fontWeight: 'bold',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\r\n            }}\r\n            title=\"放大\"\r\n          >\r\n            +\r\n          </button>\r\n          <button\r\n            onClick={handleZoomOut}\r\n            style={{\r\n              width: 30,\r\n              height: 30,\r\n              border: '1px solid #ccc',\r\n              backgroundColor: 'white',\r\n              borderRadius: '3px',\r\n              cursor: 'pointer',\r\n              fontSize: '16px',\r\n              fontWeight: 'bold',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\r\n            }}\r\n            title=\"缩小\"\r\n          >\r\n            −\r\n          </button>\r\n          <button\r\n            onClick={handleReset}\r\n            style={{\r\n              width: 30,\r\n              height: 30,\r\n              border: '1px solid #ccc',\r\n              backgroundColor: 'white',\r\n              borderRadius: '3px',\r\n              cursor: 'pointer',\r\n              fontSize: '10px',\r\n              fontWeight: 'bold',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\r\n            }}\r\n            title=\"重置视图\"\r\n          >\r\n            ⌂\r\n          </button>\r\n        </div>\r\n        \r\n        <svg ref={svgRef} style={{ cursor: 'grab' }}></svg>\r\n        \r\n        {/* Canvas渲染PM2.5网格 */}\r\n        {projection && pm25Loader && (\r\n          <PM25Canvas \r\n            pm25Loader={pm25Loader}\r\n            projection={projection}\r\n            width={1000}\r\n            height={500}\r\n            cities={cities}\r\n            transform={transform}\r\n          />\r\n        )}\r\n      </div>\r\n      <div style={{marginTop: 8, color: '#888'}}>\r\n        {pm25Loader ? \r\n          '拖拽平移地图，使用鼠标滚轮或左上角按钮缩放' :\r\n          '* Loading PM2.5 data for map coloring...'\r\n        }\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Map; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}